function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function mainRoad(p,v){var m=["#f16413","violet","#4955FE","#ffa420","#083964","#9e0000","#0073e8","#31379a","#004f57"],g=document.querySelector("#tmp-road"),e=document.querySelectorAll(".defRoad"),y={default:function(e){rDefAddPoint(e)},point:setPoint};e.forEach(function(e,t){var n,r,o=t,i=g.content.firstElementChild.cloneNode(!0),a=i.querySelector(".defRoadBoard"),l=i.querySelector(".rTenum"),u=i.querySelector(".rBenum"),s=i.querySelector(".btn-all"),c="defRoadBoard_"+t,d=(a.setAttribute("id",c),i.querySelector(".rInitoads"),i.querySelector(".rInitoads").addEventListener("change",function(e){return applySelectedOption(e.target)}),e.dataset.board||v[(null==(a=e.dataset)?void 0:a.artifact)||"artifact_0"].defBoard||"board_0"),f=e.dataset.artifact||(null==(a=p[d||"board_0"])?void 0:a.artifact)||"artifact_0";i.setAttribute("id",f),p[d]?(n=_objectSpread(_objectSpread({globalColor:m,firsPointsDefault:!1,dataInteraction:{incorrect:0,correct:0},curveMod:!1,timeInteraction:0,statusValidate:!1,pointsData:[],samePoints:[[]],textAlert:null,visible:!0,memory:[],points:[[]],curves:[],other:[],debug:!1,iMod2:[null,null],mode:10},v[f]),{},{conditions:{road:_objectSpread(_objectSpread({text:"Intenta de Nuevo",points:!1},v[f].conditions.road),{},{curve:_objectSpread({board:null,minFinishPoint:3,modNegative:null,confirmCurve:!1},v[f].conditions.road.curve)}),buttonsActive:_objectSpread({return:!0,points:!1},v[f].buttonsActive)}}),a=p[d].style,e.appendChild(i),e=gBoard(n,p[d],c,a,y,t,{globalColor:m,content:i}),n.curveGenerate=e.resultObj.curves,r=e.board,e.resultObj.points&&(n.pointsData=[].concat(_toConsumableArray(e.resultObj.points.map(function(e,t){return e.setAttribute({fixed:!0,visible:function(){return n.iMod2[0]==e.iMod[0]||n.visible},color:m[t],size:function(){return 3!=n.mode&&1!=n.mode||n.iMod!=e.iMod?2:4}}),e.interactive=!0,e.iMod=[t,0],[[[e,"eje_x"]]]})),[[]])),v[f]=n,console.log(l.textContent="hola"+t),console.log(u.textContent="hola"+t),s.addEventListener("click",function(e){var t,e=e.target;e.classList.contains("check")?rDefValidation(n,p[d],i,f,r,o):e.classList.contains("reset")?rDefReset(n,r,i,!0):e.classList.contains("back")?rDefReturn(n,r,i):e.classList.contains("curve")?n.curveMod.interactive&&1<n.points.at(-1).length&&((t=gAddCurv(n,r)).on("down",function(){y.default({def:n,board:r,attractor:t,globalColor:m})}),n.other.push(t)):e.classList.contains("road")?(gButtonToggle({def:n,button:e,mode:1}),r.update()):e.classList.contains("finishRoad")?gButtonToggle({def:n,button:e,mode:3}):e.classList.contains("pointClose")?gButtonToggle({def:n,button:e,mode:4}):e.classList.contains("visible")&&(n.visible=!n.visible,gButtonToggle({toggleResect:!1,def:n,button:e,buttonActive:"btnVisible",mode:n.mode})),r.update()}),n.helpMsg&&gHelpMsg(n,i,f),n.helpMsg||(s.querySelector(".help").style.display="none"),null!=n&&null!=(c=n.buttonsActive)&&c.back&&(s.querySelector(".back").style.display="none"),i.addEventListener("mouseenter",function(){gTime(n)}),i.addEventListener("click",function(e){e.target.classList.contains("check")||"DIV"==e.target.tagName||(n.statusValidate=!1),gTime(n)}),i.addEventListener("mouseleave",function(){gTime(n,!1,!1)})):console.warn("<!> board undefined <!>")})}function applySelectedOption(e){var t=e.options[e.selectedIndex],n=t.style.color,t=t.value;e.style.color=n,e.value=t}function rDefReturn(e,t,n){null!=e&&e.pointTarget&&(e.pointTarget.setAttribute({size:2}),e.pointTarget=null),e.curveGenerate.forEach(function(e){"finishCurve"==e.typeCurve&&e.setAttribute({visible:!1})}),setBtnColor(e,n,null),e.change=!0,removeElemet(t,e.memory.pop()),Array.isArray(null==(n=e.memory)||null==(n=n.at(-1))?void 0:n.element)&&removeElemet(t,e.memory.pop()),e.textAlert&&(e.textAlert.remove(),e.textAlert=null),e.iMod2=[null,null],t.update()}function removeElemet(t,e){var n,r,o;e&&(Array.isArray(e)&&0<e.length?e.forEach(function(e){removeElemet(t,e)}):(n=e.element,r=e.from,o=e.index,e=e.key,Array.isArray(n)||t.removeObject(n),Array.isArray(r)?r.splice(o,1):null!=e&&(r[e]=null)))}function rDefReset(e,t,n){var r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],o=(e.iMod2[0]&&(null!=e&&e.pointTarget&&(e.pointTarget.setAttribute({size:2}),e.pointTarget=null),setBtnColor(e,n,null),gButtonToggle({def:e,button:null})),[]);r&&(n=e.pointsData.map(function(e){return e.map(function(e){return e.filter(function(e){return!e[0].interactive||(o.push([[e]]),!1)})})}),e.curveGenerate.forEach(function(e){"finishCurve"==e.typeCurve&&e.setAttribute({visible:!1})}),t.removeObject(n.flat()),e.pointsData=o?[].concat(o,[[]]):[],e.memory=[],t.removeObject(e.samePoints),t.removeObject(e.points),t.removeObject(e.other.flat()),e.points=[[]],e.samePoints=[[]],e.curves=[],t.update(),e.change=!1),e.textAlert&&(e.textAlert.remove(),e.textAlert=null),e.iMod2=[null,null]}function rDefValidation(e,t,n,r,o,i){var a=e.pointsData.map(function(e){return e.map(function(e){return Array.isArray(e[0])?e.map(function(e){return[e[0].X(),e[0].Y()]}):[e[0].X(),e[0].Y()]})});e.statusValidate||(rDefRoadValidation(e,t,a,e.conditions.road)?(e.dataInteraction.incorrect=0,e.dataInteraction.correct=1,null!=(a=e.conditions)&&null!=(a=a.road)&&a.mod||generateCurveFinish(e,o,t),gAlerts({def:e,id:r,text:"Excelente",size:26})):(e.dataInteraction.incorrect=1,e.dataInteraction.correct=0,gAlerts({def:e,id:r,text:e.conditions.road.text,size:26,type:2}),setTimeout(function(){rDefReset(e,o,n,!1,i)},1e3)),e.dataInteraction.forAnner=0,e.debug?console.table(cleanData(e,r)):sendData(cleanData(e,r)),gTime(e,!1)),e.change=!1,e.statusValidate=!0}function discart(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return n[0]&&Array.isArray(n[0][0])?resp=n.some(function(e){return discart(e,r)}):Array.isArray(n)||"object"!=_typeof(n)?n.every(function(e,t){return gInterPoint(e[0],r[t][0],.2)&&gInterPoint(e[1],r[t][1],.2)&&r.length==n.length}):n.forks.every(function(t){return r.some(function(e){return discart(t,e)})})}function rDefRoadValidation(n,e,t,r,o){var i,a=null,l=!1,u=n.points.slice(0,n.points.length-1).map(function(e){return e.map(function(e){return[e.X(),e.Y()]})}),s=null!=(s=r.curve)&&s.confirmCurve?n.pointsData.map(function(e){return 0<e.length?Array.isArray(e.at(-1)[0])?e.map(function(e){return gExtractCoords(e.at(-1)[0])}):gExtractCoords(e.at(-1)[0]):[]}).filter(function(e){return 0<e.length}):[],c=n.samePoints.map(function(e){return e.map(function(e){return[e.X(),e.Y()]})});if(r.mod){if(0==(a=null!=(i=r.curve)&&i.modNegative&&0<(null==(i=r.curve)?void 0:i.modNegative.length)?r.curve.modNegative.some(function(t){return 0<u.length&&u.every(function(e){return!gCompareCurves(n.curveGenerate[t],e,!0)})}):a))return!1;null===a&&(a=!0)}else{for(var d=r.points.map(function(e){return e}),f=t.map(function(e){return e}),p=(0==f.at(-1).length&&f.pop(),d.length-1);0<=p;p--)!function(t){var e=f.findIndex(function(e){return discart(d[t],e)});-1!=e&&(d.splice(t,1),f.splice(e,1))}(p);a=0==d.length&&0==f.length}l=!(null!=(i=r.curve)&&i.modInverse&&0<(null==(t=r.curve)?void 0:t.modInverse.length))||r.curve.modInverse.some(function(t){return 0<u.length&&u.every(function(e){return gCompareCurves(n.curveGenerate[t],e,!0)})}),t=!(null!=(i=r.curve)&&i.same)||c[0].length>(null!=(i=null==(t=r.curve)||null==(t=t.same)?void 0:t.minSamePoints)?i:1)&&gCompareCurves(n.curves[0],c[0],!0),r=!(null!=(i=r.curve)&&i.confirmCurve)||s.length>=(null!=(i=null==(c=r.curve)?void 0:c.minFinishPoint)?i:2)&&gCompareCurves(n.curves[0],s.flat(),2,!0);return n.debug&&(console.warn("< resp: > ",a),console.warn("< same: > ",t),console.warn("< respConfirmCurve: > ",r),console.warn("< respInverse: > ",l)),a&&r&&t&&l}function cleanData(e,t){var n={};return(n={results:e.dataInteraction,elementArtifact:{pointsData:[[]],samePoints:[[]],curves:[]}}).artifact=Number(t.split("_").at(-1)),n.typeArtifact="Standard",n.seconds=e.timeInteraction,n.idMoodle=e.debug?"debug":$idMoodle,e.yellow&&(n.typeArtifact="Yellow",delete n.results),n}function generateCurveFinish(r,o,e){var t;null!=(t=r.conditions.road)&&t.curveReflex?null!=(t=r.conditions.road)&&t.curveReflex.forEach(function(e){var t,n;e.curve?r.curveGenerate[null==(t=e.curve)?void 0:t.index].setAttribute({visible:!0}):(n=r.reflectionAxie[e.axie],e.index.forEach(function(e){return r.other.push(o.create("reflection",[r.curveGenerate[e],n],{strokeWidth:2,strokeColor:"#d5d5d6"}))}))}):console.warn("<!>No se definio una curva para este ejercicio<!>")}function setBtnColor(e,t,n){t.querySelector(".road").style.setProperty("--color",n),t.querySelector(".curve").style.setProperty("--color",n),t.querySelector(".finishRoad").style.setProperty("--color",n),t.querySelector(".back").style.setProperty("--color",n)}function setPoint(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.def,r=t.point,t=t.content;1==n.mode&&(n.iMod2[0]=r.iMod[0],(null==n||null==(e=n.pointTarget)?void 0:e.id)!=r.id?(null!=n&&n.pointTarget&&n.pointTarget.setAttribute({size:2}),r.setAttribute({size:4}),n.pointTarget=r):(r.setAttribute({size:2}),n.pointTarget=null,n.iMod2[0]=null),setBtnColor(n,t,JSON.stringify(n.iMod2[0])==JSON.stringify(r.iMod[0])?n.globalColor[n.iMod2[0]]:null))}function conectLine(e,t,n,r,o,i,a){var l=gLineDefault({def:e,board:t,lines:{interactive:!0,strokeColor:i,firstArrow:!0,points:[r,o],dash:2,visible:function(){return JSON.stringify(e.iMod2)==JSON.stringify(r.iMod)||e.visible}},iMod:e.iMod2})[0];return l.iMod=e.iMod2,l.on("down",function(){addFinish({def:e,board:t,line:l,iMod:l.iMod,content:a})}),l}function addFinish(e){var t,n,r,o,i,a,l,u=e.def,s=e.board,c=e.iMod,e=e.content;3==u.mode&&(t=u.pointsData[c[0]][c[1]],3==u.mode)&&"finish"!=t.at(-1)[1]&&(gButtonToggle({def:u}),a=t[0][0],l=t.at(-1)[0],o=null,1<t.length&&(o=t.at(-2)[0]),gInterPoint(l.Y(),a.Y())||gInterPoint(o.X(),l.X(),.2)?r=l.Y():gInterPoint(o.X(),l.X(),.2)||(r=a.Y()),gInterPoint(l.X(),a.X())||gInterPoint(o.Y(),l.Y(),.05)?n=l.X():gInterPoint(o.Y(),l.Y(),.05)||(n=a.X()),o=u.globalColor[u.iMod2[0]],gInterPoint(l.X(),n)&&gInterPoint(l.Y(),r)?(l.setAttribute({strokeColor:"green",fillcolor:o,size:3}),t.at(-1)[1]="finish"):((i=s.create("point",[n,r],{strokeColor:"green",fillcolor:o,precision:{touch:4,touchMax:4,mouse:4,pen:4,hasPoint:1},opacity:.8,size:3,name:""})).setAttribute({visible:function(){return JSON.stringify(u.iMod2)==JSON.stringify(i.iMod)||u.visible}}),i.iMod=c,t.push([i,"finish"]),a=t.length-1,u.memory.push({element:i,from:t,index:a}),1<t.length&&(l=t.at(-2)[0],conectLine(u,s,t,i,l,o))),u.pointTarget&&(u.pointTarget.setAttribute({size:2}),u.pointTarget=null),u.iMod2=[null,null],u.visible=!0,e.querySelector(".visible").classList.remove("buttonDownActive"),e.querySelector(".finishRoad").classList.remove("buttonDownActive"),setBtnColor(u,e,null))}function rDefAddPoint(e){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_objectSpread({},e),t=e.def,n=e.board,r=e.attractor,o=e.globalColor,i=e.content;if(1==t.mode){var e=n.getUsrCoordsOfMouse(),a=n.getAllUnderMouse();if(1!=!t.mode&&-1===a.findIndex(function(e){return!Array.isArray(e)&&["glider","point"].includes(e.elType)})){var a=t.pointsData,l=t.pointTarget,l=(!t.iMod2[1]&&l?("finish"==(null==(c=a[t.iMod2[0]])||null==(c=c.at(-1))?void 0:c.at(-1)[1])&&(a[t.iMod2[0]].push([a[t.iMod2[0]][0][0]]),c=a[t.iMod2[0]].at(-1),u=a[t.iMod2[0]].length-1,c={element:c,from:a[t.iMod2[0]],index:u},t.memory.push(c)),0==a[t.iMod2[0]].length&&(a[t.iMod2[0]].push([]),u=a[t.iMod2[0]].at(-1),c=a[t.iMod2[0]].length-1,t.memory.push({element:u,from:a[t.iMod2[0]],index:c})),t.iMod2[1]=a[t.iMod2[0]].length-1):l||(a.push([[]]),u=a.at(-1),c=t.pointsData.length-1,t.iMod2[0]=a.length-1,t.iMod2[1]=a[t.iMod2[0]].length-1,t.memory.push({element:u,from:t.pointsData,index:c})),a[t.iMod2[0]][t.iMod2[1]]),u=null==t.iMod2[0]?o[a.length-1]:o[t.iMod2[0]],s=_toConsumableArray(t.iMod2),c=[].concat(_toConsumableArray(e),[r]),a=null;if(0<l.length&&(a=l.at(-1)[0])){if(!(gInterPoint(a.X(),e[0],.05)&&!gInterPoint(a.Y(),e[1],.05)||!gInterPoint(a.X(),e[0],.05)&&gInterPoint(a.Y(),e[1],.05)))return void(1==t.mode&&a.setAttribute({color:"red"}));a.setAttribute({color:u})}var d=null,o=((d=n.create("glider",c,{strokeColor:u,fillcolor:u,opacity:.8,size:2,name:"",precision:{touch:4,touchMax:4,mouse:4,pen:4,hasPoint:1},visible:function(){return JSON.stringify(t.iMod2)==JSON.stringify(s)||t.visible}})).iMod=s,l.push([d,r.typeCurve]),l.length-1),e={element:d,from:l,index:o,key:null};t.memory.push(e),1<l.length?(a=l.at(-2)[0],conectLine(t,n,l,d,a,u,i)):(d.on("down",function(){return setPoint({def:t,point:d,content:i})}),d.setAttribute({visible:!0}))}}}function createOptions(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=e.value,t=document.createElement("div");return t.value=e,t.textContent='<div class="pointClose"></div>',t}